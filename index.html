<!doctype html>
<html lang="en">

<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Pengelola Keuangan</title>

  <link href="https://fonts.googleapis.com/css?family=Poppins:100,100i,200,200i,300,300i,400,400i,500,500i,600,600i,700,700i,800,800i,900,900i" rel="stylesheet">
  <link rel="shortcut icon" type="image/icon" href="assets/logo/favicon.png" />
  <link rel="stylesheet" href="assets/css/font-awesome.min.css">
  <link rel="stylesheet" href="assets/css/linearicons.css">
  <link rel="stylesheet" href="assets/css/animate.css">
  <link rel="stylesheet" href="assets/css/flaticon.css">
  <link rel="stylesheet" href="assets/css/slick.css">
  <link rel="stylesheet" href="assets/css/slick-theme.css">
  <link rel="stylesheet" href="assets/css/bootstrap.min.css">
  <link rel="stylesheet" href="assets/css/bootsnav.css">
  <link rel="stylesheet" href="assets/css/style.css">
  <link rel="stylesheet" href="assets/css/responsive.css">

  <!-- Chart.js Library -->
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

  <style>
    input::-webkit-outer-spin-button,
    input::-webkit-inner-spin-button {
      -webkit-appearance: none;
      margin: 0;
    }

    input[type=number] {
      -moz-appearance: textfield;
    }

    .form-section {
      background: #f9f9f9;
      padding: 40px;
      border-radius: 10px;
      margin-top: 30px;
    }

    .form-group-custom {
      margin-bottom: 20px;
    }

    .form-group-custom label {
      font-size: 16px;
      font-weight: 600;
      margin-bottom: 8px;
      display: block;
    }

    .form-control {
      border-radius: 5px;
      box-shadow: none;
    }

    #hasil {
      margin-top: 25px;
      font-size: 18px;
      color: #fff;
      background: #28a745;
      padding: 20px;
      border-radius: 8px;
      display: none;
    }

    #tabelHari {
      margin-top: 20px;
      position: relative;
    }

    table {
      width: 100%;
      border-collapse: collapse;
    }

    th,
    td {
      border: 1px solid #ccc;
      padding: 10px;
      text-align: center;
    }

    th {
      background-color: #f1f1f1;
    }
  </style>
</head>

<body>
  <section class="top-area">
    <div class="header-area">
      <nav class="navbar navbar-default bootsnav navbar-sticky navbar-scrollspy" data-minus-value-desktop="70" data-minus-value-mobile="55" data-speed="1000">
        <div class="container">
          <div class="navbar-header">
            <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#navbar-menu">
              <i class="fa fa-bars"></i>
            </button>
            <a class="navbar-brand" href="index.html">Pengelola<span>Keuangan</span></a>
          </div>
          <div class="collapse navbar-collapse menu-ui-design" id="navbar-menu">
            <ul class="nav navbar-nav navbar-right" data-in="fadeInDown" data-out="fadeOutUp">
              <li class="scroll active"><a href="#home">Home</a></li>
              <li class="scroll"><a href="#works">How It Works</a></li>
              <li class="scroll"><a href="#explore">Explore</a></li>
              <li class="scroll"><a href="#reviews">Reviews</a></li>
              <li class="scroll"><a href="#blog">Blog</a></li>
              <li class="scroll"><a href="#contact">Contact</a></li>
            </ul>
          </div>
        </div>
      </nav>
    </div>
    <div class="clearfix"></div>
  </section>

  <section id="home" class="welcome-hero">
    <div class="container">
      <div class="welcome-hero-txt text-center">
        <h2>Pengelola Keuangan Pribadi</h2>
        <p>Masukkan jumlah uang dan tentukan jumlah hari. Sistem akan menghitung pengeluaran harian kamu.</p>
      </div>
      <div class="form-section">
        <div class="row">
          <div class="col-md-6 form-group-custom">
            <label for="uang">Total Uang (Rp)</label>
            <input type="text" id="uang" class="form-control" oninput="formatInputWithDots(this)" />
          </div>
          <div class="col-md-6 form-group-custom">
            <label for="hari">Jumlah Hari</label>
            <input type="number" id="hari" class="form-control" />
          </div>
        </div>
        <div class="text-center">
          <button class="btn btn-success" onclick="hitungPengeluaran()">Hitung Pengeluaran Harian</button>
        </div>
        <div id="hasil" class="text-center"></div>
      </div>
    </div>
  </section>

  <section id="works" class="how-work">
    <div class="container">
      <div class="section-header">
        <h2 class="text-center">Rincian Pengeluaran Harian</h2>
      </div>
      <div id="tabelHari"></div>
    </div>
  </section>

  <section id="explore" class="how-work">
    <div class="container">
      <div class="section-header text-center">
        <h2>Manajemen Tabungan</h2>
        <p>Masukkan jumlah tabungan yang ingin ditambah atau dikurangi.</p>
      </div>
      <div class="form-section">
        <div class="row">
          <div class="col-md-6 form-group-custom">
            <label for="tabungan-tambah">Tambah Tabungan (Rp)</label>
            <input type="text" id="tabungan-tambah" class="form-control" oninput="formatInputWithDots(this)">
          </div>
          <div class="col-md-6 form-group-custom">
            <label for="tabungan-kurang">Kurangi Tabungan (Rp)</label>
            <input type="text" id="tabungan-kurang" class="form-control" oninput="formatInputWithDots(this)">
          </div>
        </div>
        <div class="text-center">
          <button class="btn btn-primary" onclick="updateTabungan()">Simpan Perubahan Tabungan</button>
        </div>
        <div class="text-center mt-3" style="margin-top: 20px;">
          <h4>Total Tabungan Tersimpan:</h4>
          <h3 id="total-tabungan">Rp 0</h3>
        </div>
      </div>
    </div>
  </section>

  <section id="reviews" class="how-work">
    <div class="container">
      <div class="section-header text-center">
        <h2>Review Keuangan</h2>
        <p>Perbandingan Tabungan dan Pengeluaran Kamu</p>
      </div>
      <div id="review-data">
        <p>Tabungan Masuk: <span id="tabungan-masuk">Rp 0</span></p>
        <p>Pengeluaran Tabungan: <span id="tabungan-keluar">Rp 0</span></p>
        <p>Keuangan Pribadi Masuk: <span id="keuangan-masuk">Rp 0</span></p>
        <p>Pengeluaran Pribadi: <span id="keuangan-keluar">Rp 0</span></p>
      </div>
      <div>
        <canvas id="keuanganChart"></canvas>
      </div>
    </div>
  </section>

  <script src="assets/js/jquery.js"></script>
  <script>
    let uang = 0;
    let perHari = 0;
    let pengeluaranHarian = {};
    let totalTabungan = 0;
    let tabunganMasuk = 0;
    let tabunganKeluar = 0;
    let keuanganMasuk = 0;
    let keuanganKeluar = 0;

    function formatInputWithDots(input) {
      let value = input.value.replace(/\D/g, "");
      if (value === "") {
        input.value = "";
        return;
      }
      input.value = new Intl.NumberFormat('id-ID').format(parseInt(value));
    }

    function parseFormattedNumber(str) {
      return parseInt(str.replace(/\./g, "")) || 0;
    }

    function ambilDataLocalStorage() {
      const uangFromLS = localStorage.getItem('uang');
      const hariFromLS = localStorage.getItem('hari');
      const pengeluaranFromLS = localStorage.getItem('pengeluaranHarian');
      if (uangFromLS) {
        document.getElementById('uang').value = uangFromLS;
        uang = parseFormattedNumber(uangFromLS);
      }
      if (hariFromLS) {
        document.getElementById('hari').value = hariFromLS;
      }
      if (pengeluaranFromLS) {
        pengeluaranHarian = JSON.parse(pengeluaranFromLS);
      }
    }

    function hitungPengeluaran() {
      uang = parseFormattedNumber(document.getElementById("uang").value);
      const hari = parseInt(document.getElementById("hari").value);
      const hasilEl = document.getElementById("hasil");
      const tabelHari = document.getElementById("tabelHari");

      if (!isNaN(uang) && !isNaN(hari) && uang > 0 && hari > 0) {
        perHari = Math.round((uang / hari) / 1000) * 1000;
        hasilEl.style.display = "block";
        hasilEl.innerText = `Kamu bisa menghabiskan sekitar Rp ${new Intl.NumberFormat('id-ID').format(perHari)} per hari.`;

        let tableHTML = `<table><thead><tr><th>Hari</th><th>Pengeluaran (Rp)</th><th>Masukkan Pengeluaran</th><th>Pengeluaran Terbaru (Rp)</th></tr></thead><tbody>`;

        for (let i = 1; i <= hari; i++) {
          const pengeluaranHari = pengeluaranHarian[i] || 0;
          const pengeluaranBaru = perHari - pengeluaranHari;

          tableHTML += `
            <tr>
              <td>${i}</td>
              <td>${new Intl.NumberFormat('id-ID').format(perHari)}</td>
              <td><input type="text" class="form-control" id="pengeluaran-${i}" oninput="updatePengeluaran(${i})" value="${new Intl.NumberFormat('id-ID').format(pengeluaranHari)}"></td>
              <td id="terbaru-${i}">${new Intl.NumberFormat('id-ID').format(pengeluaranBaru)}</td>
            </tr>`;
        }

        tableHTML += '</tbody></table>';
        tabelHari.innerHTML = tableHTML;
      } else {
        hasilEl.style.display = "block";
        hasilEl.innerText = "Masukkan nilai yang valid untuk uang dan hari.";
        tabelHari.innerHTML = "";
      }

      localStorage.setItem('uang', document.getElementById("uang").value);
      localStorage.setItem('hari', hari);
    }

    function updatePengeluaran(hari) {
      const input = document.getElementById(`pengeluaran-${hari}`);
      formatInputWithDots(input);
      const pengeluaran = parseFormattedNumber(input.value);
      pengeluaranHarian[hari] = pengeluaran;

      const totalHari = parseInt(document.getElementById("hari").value);
      let totalPengeluaran = 0;
      for (let i = 1; i <= totalHari; i++) {
        totalPengeluaran += pengeluaranHarian[i] || 0;
      }

      const sisaUang = uang - totalPengeluaran;
      document.getElementById("hasil").innerText = `Total Sisa Uang: Rp ${new Intl.NumberFormat('id-ID').format(sisaUang)}`;

      const pengeluaranBaru = perHari - pengeluaran;
      document.getElementById(`terbaru-${hari}`).innerText = new Intl.NumberFormat('id-ID').format(pengeluaranBaru);

      localStorage.setItem('pengeluaranHarian', JSON.stringify(pengeluaranHarian));
    }

    function updateTabungan() {
      const tambah = parseFormattedNumber(document.getElementById("tabungan-tambah").value) || 0;
      const kurang = parseFormattedNumber(document.getElementById("tabungan-kurang").value) || 0;

      totalTabungan = parseInt(localStorage.getItem("totalTabungan") || 0);
      totalTabungan += tambah;
      totalTabungan -= kurang;
      if (totalTabungan < 0) totalTabungan = 0;

      document.getElementById("total-tabungan").innerText = `Rp ${new Intl.NumberFormat('id-ID').format(totalTabungan)}`;
      localStorage.setItem("totalTabungan", totalTabungan);

      tabunganMasuk += tambah;
      tabunganKeluar += kurang;

      localStorage.setItem("tabunganMasuk", tabunganMasuk);
      localStorage.setItem("tabunganKeluar", tabunganKeluar);

      document.getElementById("tabungan-tambah").value = '';
      document.getElementById("tabungan-kurang").value = '';

      updateReviewData();
    }

    function ambilTabungan() {
      totalTabungan = parseInt(localStorage.getItem("totalTabungan") || 0);
      tabunganMasuk = parseInt(localStorage.getItem("tabunganMasuk") || 0);
      tabunganKeluar = parseInt(localStorage.getItem("tabunganKeluar") || 0);
      keuanganMasuk = parseInt(localStorage.getItem("keuanganMasuk") || 0);
      keuanganKeluar = parseInt(localStorage.getItem("keuanganKeluar") || 0);

      document.getElementById("total-tabungan").innerText = `Rp ${new Intl.NumberFormat('id-ID').format(totalTabungan)}`;
      updateReviewData();
    }

    function updateReviewData() {
      document.getElementById("tabungan-masuk").innerText = `Rp ${new Intl.NumberFormat('id-ID').format(tabunganMasuk)}`;
      document.getElementById("tabungan-keluar").innerText = `Rp ${new Intl.NumberFormat('id-ID').format(tabunganKeluar)}`;
      document.getElementById("keuangan-masuk").innerText = `Rp ${new Intl.NumberFormat('id-ID').format(keuanganMasuk)}`;
      document.getElementById("keuangan-keluar").innerText = `Rp ${new Intl.NumberFormat('id-ID').format(keuanganKeluar)}`;

      // Update chart
      const ctx = document.getElementById("keuanganChart").getContext("2d");
      const chartData = {
        labels: ["Tabungan", "Pengeluaran Tabungan", "Keuangan Pribadi", "Pengeluaran Pribadi"],
        datasets: [{
          label: "Uang (Rp)",
          data: [tabunganMasuk, tabunganKeluar, keuanganMasuk, keuanganKeluar],
          backgroundColor: ["#36A2EB", "#FF6384", "#FFCE56", "#4CAF50"],
          borderColor: ["#36A2EB", "#FF6384", "#FFCE56", "#4CAF50"],
          borderWidth: 1
        }]
      };

      const config = {
        type: "bar",
        data: chartData,
        options: {
          scales: {
            y: {
              beginAtZero: true
            }
          }
        }
      };

      new Chart(ctx, config);
    }

    // Ambil data dari Local Storage saat halaman dimuat
    ambilDataLocalStorage();
    ambilTabungan();
  </script>
</body>

</html>
